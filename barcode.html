<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barcode - Een Barcode</title>
<style>
html, body {
  margin: 0;
  padding: 20px;
  height: 100%;
  width: 100%;
  font-family: Arial, sans-serif;
  color: white;
  text-align: center;
  background: url('anime2.jpg') no-repeat center center;
  background-size: cover;
  overflow-x: hidden; /* cegah geser horizontal */
}

#topButton {
  position: fixed;
  top: 15px;
  left: 50%;
  transform: translateX(-50%);
  padding: 10px 20px;
  font-weight: bold;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(135deg, #36d1dc, #5b86e5);
  color: white;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  z-index: 1000;
}

#qrcode {
  margin-top: 80px;
  display: flex;
  justify-content: center;
}

#qrcode canvas {
  width: 80vw !important;  /* responsif */
  height: 80vw !important;
  max-width: 400px;        /* biar ga kebesaran di tablet */
  max-height: 400px;
}

.barcode-number {
  font-size: 20px;
  font-weight: bold;
  text-shadow: 1px 1px 3px black;
  margin: 12px;
}

.checkboxes {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  justify-content: center;
  margin-bottom: 20px;
}

.checkboxes label {
  font-size: 16px;
  color: white;
  background: rgba(0,0,0,0.5);
  padding: 5px 12px;
  border-radius: 8px;
}

.navBtn {
  position: fixed;
  bottom: 25px;
  background: rgba(255,255,255,0.8);
  border: none;
  padding: 12px;
  border-radius: 50%;
  font-size: 22px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
}

#prevBtn { left: 20px; }
#nextBtn { right: 20px; }
</style>
</head>
<body>

<button id="topButton" onclick="goBack()">⬅️ Kembali</button>
<div id="qrcode"></div>
<div class="barcode-number" id="barcodeNumber"></div>
<div class="checkboxes" id="checkboxContainer"></div>
<button id="prevBtn" class="navBtn">⬅</button>
<button id="nextBtn" class="navBtn">➡</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
let barcodes=[], currentIndex=0, checks={};
const qrcodeDiv=document.getElementById('qrcode');
const barcodeNumberDiv=document.getElementById('barcodeNumber');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');
const checkboxContainer=document.getElementById('checkboxContainer');

function getParam(name){ return new URLSearchParams(window.location.search).get(name); }
function goBack(){ window.location.href="menu.html"; }

const type=getParam("type");
const file=(type==="pertalite")?"datapertalite.csv":"datasolar.csv";

fetch(file)
.then(res=>res.text())
.then(text=>{
  barcodes=text.trim().split("\n");
  if(barcodes.length>0) showBarcode(0);
});

function showBarcode(index){
  qrcodeDiv.innerHTML="";
  barcodeNumberDiv.textContent=`#${index+1}`;
  new QRCode(qrcodeDiv,{text:barcodes[index], width:400, height:400});

  checkboxContainer.innerHTML="";
  if(type==="solar"){
    checkboxContainer.innerHTML = `
      <label><input type="checkbox" id="check1"> Cek 1</label>
      <label><input type="checkbox" id="check2"> Cek 2</label>`;
    document.getElementById("check1").checked = checks[index]?.check1 || false;
    document.getElementById("check2").checked = checks[index]?.check2 || false;
    document.getElementById("check1").addEventListener("change",()=>saveCheck(index));
    document.getElementById("check2").addEventListener("change",()=>saveCheck(index));
  } else {
    checkboxContainer.innerHTML = `<label><input type="checkbox" id="check1"> Cek 1</label>`;
    document.getElementById("check1").checked = checks[index]?.check1 || false;
    document.getElementById("check1").addEventListener("change",()=>saveCheck(index));
  }
}

function saveCheck(index){
  const currentChecks={};
  if(type==="solar"){
    currentChecks.check1=document.getElementById("check1").checked;
    currentChecks.check2=document.getElementById("check2").checked;
  } else {
    currentChecks.check1=document.getElementById("check1").checked;
  }
  checks[index]=currentChecks;
}

nextBtn.addEventListener("click",()=>{
  saveCheck(currentIndex);
  if(currentIndex<barcodes.length-1){ currentIndex++; showBarcode(currentIndex); }
  else{ alert("Ini barcode terakhir."); }
});

prevBtn.addEventListener("click",()=>{
  saveCheck(currentIndex);
  if(currentIndex>0){ currentIndex--; showBarcode(currentIndex); }
  else{ alert("Ini barcode pertama."); }
});
</script>
</body>
</html>
