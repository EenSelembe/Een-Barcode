<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Barcode - EEN BARCODE WEBSITE</title>
<style>
html, body {
  margin:0; padding:0; height:100%; width:100%;
  font-family:Arial,sans-serif; color:white; text-align:center;
  background: url('anime2.jpg') no-repeat center center fixed;
  background-size: cover;
  overflow:hidden;
}

#topButton {
  position:absolute; 
  top:20px; 
  left:50%; 
  transform:translateX(-50%);
  padding:12px 25px; 
  font-weight:bold; 
  font-size:18px; 
  border:none;
  border-radius:8px; 
  background:linear-gradient(135deg,#36d1dc,#5b86e5);
  color:white; 
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,0.5);
  z-index:9999;
}

.barcode-container {
  position: relative;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  height:100vh;
  padding-top:180px;
  box-sizing:border-box;
}

#qrcode canvas {
  width:80vw !important;
  height:80vw !important;
  max-width:400px;
  max-height:400px;
  border: 6px solid white;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(255,255,255,0.7);
}

.barcode-number {
  font-size:22px;
  font-weight:bold;
  text-shadow:1px 1px 3px black;
  margin:12px;
}

.checkboxes {
  display:flex;
  gap:20px;
  justify-content:center;
  margin-top:10px;
}
.checkboxes label {
  font-size:18px;
  color:white;
  background: rgba(0,0,0,0.5);
  padding:5px 10px;
  border-radius:8px;
}

/* ‚úÖ Nama pengguna dengan gradient + glow */
#usernameDisplay {
  margin-top:20px;
  font-size:28px;
  font-weight:700;
  text-transform:uppercase;
  background:linear-gradient(90deg,#ff0080,#ff8c00,#40e0d0);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  animation:glow 2s infinite alternate;
  text-shadow:2px 2px 10px rgba(0,0,0,0.7);
}
@keyframes glow {
  from { text-shadow:2px 2px 8px rgba(0,0,0,0.6); }
  to   { text-shadow:2px 2px 20px rgba(255,255,255,0.9); }
}

.navBtn {
  position:absolute;
  top:80%;
  transform:translateY(-50%);
  background: rgba(255,255,255,0.7);
  border:none;
  padding:20px;
  border-radius:50%;
  font-size:36px;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,0.4);
}
#prevBtn { left:20px; }
#nextBtn { right:20px; }

/* ‚ö†Ô∏è Peringatan */
.warning {
  position:absolute;
  bottom:10px;
  width:100%;
  overflow:hidden;
  white-space:nowrap;
  font-size:22px;
  font-weight:bold;
  color:red;
  text-shadow:0 0 10px #ff0000, 0 0 20px #ff0000;
}
.warning span {
  display:inline-block;
  padding-left:100%;
  animation:scrollText 6s linear infinite;
}
@keyframes scrollText {
  from { transform:translateX(0); }
  to   { transform:translateX(-100%); }
}

/* ‚úÖ Tombol reset ceklis */
#resetChecks {
  position:absolute;
  bottom:60px;   /* agak longgar dari teks merah */
  left:50%;
  transform:translateX(-50%);
  background:rgba(255,255,255,0.8);
  border:none;
  padding:16px;
  border-radius:50%;
  font-size:26px;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,0.4);
}
</style>
</head>
<body>

<button id="topButton" onclick="goBack()">‚¨ÖÔ∏è Kembali</button>

<div class="barcode-container">
  <div id="qrcode"></div>
  <div class="barcode-number" id="barcodeNumber"></div>
  <div class="checkboxes" id="checkboxContainer"></div>
  <!-- ‚úÖ Nama pengguna -->
  <div id="usernameDisplay"></div>
</div>

<button id="prevBtn" class="navBtn">‚¨Ö</button>
<button id="nextBtn" class="navBtn">‚û°</button>

<!-- ‚úÖ Tombol reset ceklis -->
<button id="resetChecks">üîÑ</button>

<div class="warning"><span>!!! TOLONG RAHASIAKAN BARCODE INI DARI SIAPAPUN !!!</span></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
let barcodes=[], currentIndex=0;
const type=getParam("type");
let checks = JSON.parse(localStorage.getItem("checks_"+type)) || {};

const qrcodeDiv=document.getElementById('qrcode');
const barcodeNumberDiv=document.getElementById('barcodeNumber');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');
const checkboxContainer=document.getElementById('checkboxContainer');
const usernameDisplay=document.getElementById("usernameDisplay");
const resetBtn=document.getElementById("resetChecks");

function getParam(name){ return new URLSearchParams(window.location.search).get(name); }
function goBack(){ window.location.href="menu.html"; }

// ‚úÖ Ambil username dari localStorage
const user = localStorage.getItem("currentUser") || "Pengguna";
usernameDisplay.textContent = "üë§ " + user;

const file=(type==="pertalite")?"datapertalite.csv":"datasolar.csv";

fetch(file)
.then(res=>res.text())
.then(text=>{
  barcodes=text.trim().split("\n");
  if(barcodes.length>0) showBarcode(0);
});

function showBarcode(index){
  qrcodeDiv.innerHTML="";
  barcodeNumberDiv.textContent=`#${index+1}`;
  new QRCode(qrcodeDiv,{text:barcodes[index], width:600, height:600});

  checkboxContainer.innerHTML="";
  if(type==="solar"){
    checkboxContainer.innerHTML = `
      <label><input type="checkbox" id="check1"> Cek 1</label>
      <label><input type="checkbox" id="check2"> Cek 2</label>`;
    document.getElementById("check1").checked = checks[index]?.check1 || false;
    document.getElementById("check2").checked = checks[index]?.check2 || false;
    document.getElementById("check1").addEventListener("change",()=>saveCheck(index));
    document.getElementById("check2").addEventListener("change",()=>saveCheck(index));
  } else {
    checkboxContainer.innerHTML = `<label><input type="checkbox" id="check1"> Cek 1</label>`;
    document.getElementById("check1").checked = checks[index]?.check1 || false;
    document.getElementById("check1").addEventListener("change",()=>saveCheck(index));
  }
}

function saveCheck(index){
  const currentChecks={};
  if(type==="solar"){
    currentChecks.check1=document.getElementById("check1").checked;
    currentChecks.check2=document.getElementById("check2").checked;
  } else {
    currentChecks.check1=document.getElementById("check1").checked;
  }
  checks[index]=currentChecks;
  localStorage.setItem("checks_"+type, JSON.stringify(checks));
}

nextBtn.addEventListener("click",()=>{
  saveCheck(currentIndex);
  if(currentIndex<barcodes.length-1){ currentIndex++; showBarcode(currentIndex); }
  else{ alert("Ini barcode terakhir."); }
});

prevBtn.addEventListener("click",()=>{
  saveCheck(currentIndex);
  if(currentIndex>0){ currentIndex--; showBarcode(currentIndex); }
  else{ alert("Ini barcode pertama."); }
});

// ‚úÖ Fungsi reset semua ceklis
resetBtn.addEventListener("click",()=>{
  if(confirm("Hapus semua status ceklis?")){
    checks = {};
    localStorage.removeItem("checks_"+type);
    showBarcode(currentIndex);
  }
});
</script>
</body>
</html>
