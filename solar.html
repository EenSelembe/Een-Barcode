<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Biosolar QR</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="barcodeSection">
    <button id="backBtn" class="back-btn">⬅ Kembali</button>
    <div id="qrcode"></div>
    <div class="barcode-number" id="barcodeNumber"></div>
    <div class="checkboxes">
      <label><input type="checkbox" id="check1"> Cek 1</label>
      <label><input type="checkbox" id="check2"> Cek 2</label>
    </div>
    <button id="prevBtn" class="navBtn">⬅</button>
    <button id="nextBtn" class="navBtn">➡</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    if (localStorage.getItem("loggedIn") !== "true") {
      window.location.href = "home.html";
    }

    let barcodes = [];
    let currentIndex = 0;
    let checks = {};

    const qrcodeDiv = document.getElementById('qrcode');
    const barcodeNumberDiv = document.getElementById('barcodeNumber');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const check1 = document.getElementById('check1');
    const check2 = document.getElementById('check2');

    async function loadCSV() {
      const response = await fetch("datasolar.csv");
      const text = await response.text();
      const rows = text.trim().split(/\r?\n/).slice(1);

      barcodes = rows.map(row => {
        const cols = row.split(",");
        return { kode: cols[0].trim(), nomor: cols[1]?.trim() || "" };
      });
      showBarcode(0);
    }

    function showBarcode(index) {
      qrcodeDiv.innerHTML = "";
      if (index < 0 || index >= barcodes.length) return;

      new QRCode(qrcodeDiv, {
        text: barcodes[index].kode,
        width: 600,
        height: 600
      });

      barcodeNumberDiv.textContent = `#${index + 1} - ${barcodes[index].nomor}`;
      check1.checked = checks[index]?.check1 || false;
      check2.checked = checks[index]?.check2 || false;
    }

    function saveCheck() {
      checks[currentIndex] = { check1: check1.checked, check2: check2.checked };
    }

    check1.addEventListener("change", saveCheck);
    check2.addEventListener("change", saveCheck);

    nextBtn.addEventListener("click", () => {
      saveCheck();
      if (currentIndex < barcodes.length - 1) {
        currentIndex++;
        showBarcode(currentIndex);
      } else {
        alert("Ini barcode terakhir.");
      }
    });

    prevBtn.addEventListener("click", () => {
      saveCheck();
      if (currentIndex > 0) {
        currentIndex--;
        showBarcode(currentIndex);
      } else {
        alert("Ini barcode pertama.");
      }
    });

    document.getElementById("backBtn").addEventListener("click", () => {
      window.location.href = "home.html";
    });

    loadCSV();
  </script>
</body>
</html>
